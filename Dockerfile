# base image
FROM ubuntu:latest

# define environment variables
ENV HOME=/home/apb

# create the main folder
RUN mkdir -p $HOME

# set working directory
WORKDIR $HOME

# update and install some packages
RUN apt-get update && apt-get install -y --no-install-recommends ca-certificates curl mlocate nano
RUN apt-get install -y --no-install-recommends jq ffuf wfuzz 

# install python packages
RUN curl -L -O https://bootstrap.pypa.io/get-pip.py && python3 get-pip.py && rm get-pip.py
RUN pip install --verbose --upgrade --user requests beautifulsoup4 selenium

# install golang
RUN curl -L -O https://go.dev/dl/go1.20.2.linux-amd64.tar.gz && rm -rf /usr/local/go && tar -C /usr/local -xzf go1.20.2.linux-amd64.tar.gz && echo "export PATH=$PATH:/usr/local/go/bin" >> ~/.profile && rm go1.20.2.linux-amd64.tar.gz

# install golang modules
RUN . ~/.profile && go install -v github.com/tomnomnom/anew@latest ; go install -v github.com/tomnomnom/gf@latest ; go install -v github.com/tomnomnom/qsreplace@latest ; go install -v github.com/tomnomnom/unfurl@latest ; go install -v github.com/lc/gau@latest ; go install -v github.com/lc/subjs@latest ; go install -v github.com/Emoe/kxss@latest

# install pdtm and all pdtm tools
RUN . ~/.profile && go install -v github.com/projectdiscovery/pdtm/cmd/pdtm@latest && echo "export PATH=$PATH:~/.pdtm/go/bin:~/go/bin" >> ~/.profile
RUN . ~/.profile && pdtm -install-all -verbose 

# TODO how to handle the .config for notify & subfinder (maybe volumes use)

# set PATH variables  
RUN cat ~/.profile >> ~/.bashrc

# launch command
CMD ["sleep","infinity"]
