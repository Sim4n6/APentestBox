# Use an official, minimal runtime as a parent image
FROM ubuntu:latest

# Set the working directory
WORKDIR /app

# Set environment variables
ENV USERNAME=apb \
    LC_ALL=en_US.UTF-8 \
    LANG=en_US.UTF-8 \
    LANGUAGE=en_US:en

# Update the package list and install prerequisites
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    apt-utils \
    ca-certificates \
    curl \
    locales \
    locales-all \
    mlocate \
    nano \
    python3-pip \
    sudo

# Install additional packages
RUN apt-get install -y --no-install-recommends \
    ffuf \
    jq \
    wfuzz

# Add a new user and set its shell to bash
# RUN useradd -ms /bin/bash $USERNAME && \
#     usermod -aG sudo $USERNAME && \
#     echo "$USERNAME ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers.d/$USERNAME && \
#     chmod 0440 /etc/sudoers.d/$USERNAME

# Switch to the new user
#USER $USERNAME

# Install Python packages
RUN python3 -m pip install --upgrade pip && \
    python3 -m pip install --verbose --upgrade --user \
    beautifulsoup4 \
    requests \
    selenium

# Install Golang
ENV PATH=/usr/local/go/bin:$PATH \
    GOPATH=$HOME/go
RUN curl -L https://go.dev/dl/go1.19.7.linux-amd64.tar.gz -o go.tar.gz && \
    tar -C /usr/local -xzf go.tar.gz && \
    rm go.tar.gz

# Install Golang modules
RUN go install -v github.com/tomnomnom/anew@latest 
RUN go install -v github.com/tomnomnom/qsreplace@latest
RUN go install -v github.com/tomnomnom/unfurl@latest
RUN go install -v github.com/lc/gau@latest
RUN go install -v github.com/lc/subjs@latest
RUN go install -v github.com/Emoe/kxss@latest 
RUN go install -v github.com/ffuf/ffuf/v2@latest
RUN go install -v github.com/projectdiscovery/pdtm/cmd/pdtm@latest

# Install Pdtm and its tools
ENV PATH=$HOME/.pdtm/go/bin:$GOPATH/bin:$PATH
RUN pdtm -install-all -verbose

# Add the startup script and make it executable
COPY startup.sh /app/

# Set the default command to bash
CMD ["bash"]
